# 扩展功能优化计划

本文档旨在记录"Twitter推文收藏器"扩展的后续功能优化路线图，并对已尝试的方案进行回顾和分析。

---

## 第一次优化回顾：原生文件夹选择（方案不可行）

### 目标
允许用户通过点击一个按钮，直接打开操作系统的原生"选择文件夹"对话框，来指定一个**绝对路径**作为推文的保存位置（例如 `D:\MyTweets`）。

### 尝试的方案
我们采用了一种巧妙的"虚拟下载"技巧来实现此功能：
1.  **触发下载**：在后台脚本中，调用 `chrome.downloads.download()` API，并设置 `saveAs: true`。
2.  **用户交互**：这会强制Chrome浏览器弹出一个原生的"另存为..."对话框。我们引导用户在该对话框中选择任意想要保存的文件夹，然后点击"保存"。
3.  **路径捕获**：通过监听 `chrome.downloads.onChanged` 事件，我们可以在这个虚拟文件"下载"完成时，捕获到它被保存的完整路径，从而提取出用户选择的文件夹路径。

### 失败原因分析：Chrome扩展的安全沙箱限制

尽管这个方案在逻辑上是可行的，但我们遇到了一个由Chrome扩展安全模型导致的根本性障碍。

Chrome为了保护用户安全，将扩展运行在一个严格的**沙箱环境**中，严格限制其对用户本地文件系统的访问权限。

当我们触发"另-存为"对话框时：
- 如果用户选择的是默认的"下载"文件夹或其子文件夹，一切正常。
- 但是，如果用户选择了**"下载"文件夹之外的任何位置**（例如 `E:\twitter`），Chrome的安全机制会介入。它**不会**将这个真实的绝对路径 (`E:\twitter`) 返回给扩展。
- 相反，Chrome会自动在默认的"下载"文件夹内创建一个模拟路径（例如 `C:\Users\YourUser\Downloads\E_\twitter`），并将文件保存在那里。

**结论：** 任何试图通过 `chrome.downloads` API 来获取并使用"下载"文件夹之外的任意绝对路径的尝试，都会被Chrome的安全策略阻止。这是扩展平台为了防止恶意扩展扫描或修改用户文件系统而设计的核心安全特性，我们无法绕过。因此，**直接让用户选择任意绝对路径的方案在技术上是不可行的。**

---

## 后续优化路线图

既然直接选择绝对路径不可行，我们将继续遵循相对路径的原则，并从以下几个方面继续打磨产品：

### 阶段一：核心体验优化
-   [ ] **一键收藏**：在推文信息的右上角（"..."菜单旁）直接添加一个收藏图标，减少用户操作步骤。
-   [ ] **即时反馈**：点击收藏后，在页面右下角弹出一个短暂的、非打扰式的提示（Toast Notification），明确告知用户"收藏成功"或"收藏失败"，取代当前仅在后台输出日志的方式。
-   [ ] **美化推文浏览器**：优化 `tweet-browser.html` 的视觉样式，使其更像一个现代化的卡片式列表，提升本地浏览体验。

### 阶段二：效率功能
-   [ ] **批量收藏**：在用户个人主页或推文详情页，增加"收藏该用户所有推文"或"收藏串内所有推文"的功能。
-   [ ] **键盘快捷键**：为收藏操作增加全局键盘快捷键（例如 `Alt+Shift+S`），让高级用户可以脱离鼠标操作。
-   [ ] **自动标签**：在保存时，根据推文内容（例如 `#话题标签`）自动为文件添加标签或创建子文件夹。

### 阶段三：高级功能与专业化
-   [ ] **云端同步**：集成 Google Drive 或 Dropbox API，允许用户将推文直接保存到云端。
-   [ ] **高级搜索**：在推文浏览器中增加按日期范围、用户、关键词、是否包含媒体等条件的筛选和搜索功能。
-   [ ] **新用户引导**：为首次安装的用户提供一个简洁的、一次性的功能向导。
-   [ ] **国际化 (i18n)**：增加对英语等其他语言的支持。

---

## 下一步行动建议

我建议我们从**阶段一：核心体验优化**开始。其中，**"即时反馈"** 功能的投入产出比最高。它能极大地提升操作的确定性，让用户明确知道自己的每一次点击都得到了响应。

您希望我们开始实施"即时反馈"功能吗？ 