# 更新日志

所有此项目的显著更改都将记录在此文件中。

格式基于 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)，
并且本项目遵循 [Semantic Versioning](https://semver.org/spec/v2.0.0.html)。

## [2.0.3] - 2025-07-12

### 改进 (Improved)

- 优化了弹窗操作按钮的布局，将“推文浏览器”按钮调整为主按钮位置，并将“测试连接”按钮替换为“帮助文档”按钮，以提供更直观的用户体验。

### 修复 (Fixed)

- 修复了“帮助文档”按钮无法访问文件的问题，确保 `help.html` 在构建过程中被正确复制到发布目录，现在帮助页面可以正常打开。

## [2.0.2] - 2025-07-12

### 新增 (Added)

- 支持同时选择多种文件格式进行保存，将原有的下拉选择框改为多选复选框，提升了使用的灵活性。

## [2.0.1] - 2025-07-12

### 修复 (Fixed)

- 修复了因类型定义不一致导致在选择 "JSON" 或 "Markdown" 格式时收藏失败的问题。现在所有文件格式都能正常生成和保存。

## [2.0.0] - 2024-07-28
- **🎉 重大重构：TypeScript & 现代化构建**
  - **核心迁移**: 整个扩展从 Vanilla JavaScript 完全重构为 **TypeScript**，提供了强类型支持，增强了代码的健壮性和可维护性。
  - **构建系统**: 引入了基于 **Vite** 和 **Rollup** 的现代化构建流程，替代了之前的手动文件管理。
    - 为 Background Script (Service Worker), Popup, 和 Content Script 创建了独立的 Rollup 配置，解决了 ES 模块在扩展环境中不兼容的问题。
    - 实现了自动化的构建、清理和资源复制 (`npm run build`)。
  - **项目结构**: 采用了全新的 `src` 目录结构，按功能模块（`background`, `content`, `popup`, `utils` 等）组织源代码，使项目结构更清晰。
- **🔧 关键 Bug 修复与功能稳定**
  - **修复**: 解决了 Service Worker 因 ES 模块导入而无法注册的致命问题。
  - **修复**: 解决了后台脚本中因调用 `document` 和 `URL.createObjectURL` 等浏览器端 API 导致的崩溃问题，改用兼容 Service Worker 的实现。
  - **修复**: 修正了构建脚本中资源文件（图标、HTML页面等）丢失，导致功能不完整的问题。
  - **修复**: 统一了 `manifest.json`, `package.json` 中的版本号，解决了版本混乱的问题。
- **✨ 总体提升**
  - **稳定性**: 通过重构和一系列关键修复，插件的稳定性和可靠性得到大幅提升。
  - **可维护性**: TypeScript 和模块化的引入，使得未来添加新功能和修复问题变得更加容易。
  - **开发效率**: 现代化的构建流程极大地提升了开发和调试的效率。

### v1.2.0 - 2024-12-20
- **🎉 功能增强与重构**
  - **新增**: 保存推文时，会自动下载作者的头像。
  - **优化**: 重构了文件保存逻辑，现在每条推文及其所有媒体文件（包括头像）都会保存在一个以推文信息命名的独立文件夹中，解决了路径混乱问题。
  - **修复**: 彻底修复了推文浏览器无法显示作者头像的bug，现在能够正确解析和展示本地头像文件。
- **🔧 技术改进**
  - **新增**: 添加了 `.cursorrules` 文件，为项目引入了统一的、专业的开发规范。
  - **优化**: 改进了 `background.js` 中的媒体下载逻辑，使其更具模块化和健壮性。
  - **优化**: 改进了 `tweet-browser.js` 中的路径解析逻辑，以适应新的文件结构。

### v1.1.9 - 2024-12-19
- **修复**: 修复了推文浏览器中因HTML转义导致推文正文显示为原始标签（乱码）的问题。
- **安全**: 对推文浏览器中的用户名和用户Handle进行HTML转义，增强了安全性。

### v1.1.8 - 2024-12-19
- **新功能**: 在HTML文件和推文浏览器中添加"查看原文"按钮，方便快速追溯原始推文。
- **修复**: 修正了推文浏览器无法正确解析和显示推文统计数据（回复、转推、点赞）的问题。

## [1.1.7] - 2024-12-19
### 🎨 界面优化
- **全新弹出界面**：完全重新设计了弹出设置界面，使其更简洁、美观和用户友好。
- **简化布局**：移除了功能描述、调试工具、帮助和重置按钮，聚焦核心设置。
- **视觉增强**：引入了卡片式设计、柔和的背景渐变、更清晰的字体层级以及emoji点缀，提升了整体美感。
- **修复对齐问题**：彻底解决了输入框和按钮的垂直对齐问题，使界面更规整。

### 🐛 修复
- 修复了推文浏览器在导入包含不完整数据的JSON文件时，会卡在"正在加载"界面的问题。

## [1.1.6] - 2024-12-19
### 🐛 修复
- 修复推文浏览器因内容安全策略（CSP）限制导致无法导入文件的问题
- 将内联JavaScript代码重构为外部文件（tweet-browser.js）以符合Manifest V3安全规范

### 🔧 技术改进
- 遵循CSP最佳实践，提高了扩展页面的安全性
- 优化了推文浏览器页面的脚本加载逻辑

## [1.1.5] - 2024-12-19
### 🎉 重大改进
- **修复保存路径无法修改的问题**：用户现在可以完全控制保存路径设置
- **新增路径选择对话框**：点击"选择路径"按钮会弹出友好的路径选择界面
- **支持绝对路径**：用户可以使用完整的文件夹路径（如：C:/MyFolder/Twitter）
- **支持相对路径**：保持对相对路径的完整支持（如：Downloads/Twitter）

### 🛠️ 功能增强
- 优化路径验证逻辑，区分绝对路径和相对路径的验证规则
- 改进路径清理算法，正确处理不同格式的路径
- 提供路径类型提示，帮助用户了解当前路径格式
- 增强对话框界面，支持鼠标点击、ESC键等多种交互方式

### 📚 文档更新
- 更新帮助文档，详细说明绝对路径和相对路径的使用方法
- 提供丰富的路径示例，覆盖Windows、Linux、Mac系统
- 增强路径注意事项说明，帮助用户避免常见错误

### 🎨 界面改进
- 更新输入框占位符，提供更清晰的示例
- 改进按钮文本，从"浏览"改为"选择路径"
- 增加路径类型验证反馈，实时提示用户输入状态

## [1.1.4] - 2024-01-XX
### 修复
- 修复Chrome扩展上下文失效导致的"Cannot read properties of undefined (reading 'sendMessage')"错误
- 增强Chrome扩展API可用性检查，避免在扩展失效时调用API
- 改进错误处理机制，提供更准确的错误信息
- 优化sendMessage调用，使用Promise包装以更好地处理异步错误

### 改进
- 增强用户反馈机制，根据不同错误类型显示相应提示
- 优化错误信息显示，区分"扩展失效"、"连接失败"、"提取失败"等不同情况
- 提高插件的稳定性和可靠性

## [1.1.3] - 2024-01-XX
### 修复
- 修复Content Security Policy (CSP) 违规问题
- 移除HTML文件中的内联事件处理器（onclick、onload等）
- 改进下载过程的错误处理和状态监听
- 修复扩展上下文失效导致的错误

### 改进
- 使用addEventListener替代内联事件处理
- 增强下载完成状态检查
- 添加下载超时保护机制

## [1.1.2] - 2024-01-XX
### 修复
- 修复模板字符串中的空值处理问题
- 改进HTML和Markdown生成的错误处理
- 确保所有模板变量都有默认值保护

### 改进
- 移除可能干扰运行的调试日志
- 优化错误信息显示

## [1.1.1] - 2024-01-XX
### 修复
- 修复图片提取bug，避免保存无关图片（头像、表情符号等）
- 改进图片选择器，使用更精确的匹配规则
- 优化媒体文件下载逻辑

### 改进
- 更好的媒体内容识别
- 改进HTML和Markdown格式的媒体部分显示

## [1.1.0] - 2024-01-XX
### 新增
- HTML格式导出功能
- Markdown格式导出功能
- 媒体文件下载支持
- 调试工具页面
- 帮助页面
- 推文浏览器功能

### 改进
- 更好的用户界面
- 增强的交互体验
- 更详细的错误信息

## [1.0.0] - 2024-01-XX
### 新增
- 初始版本发布
- 基础推文收藏功能
- JSON格式导出
- 支持Twitter和X.com域名
- 推文数据提取和保存

---

## [v1.1.3] - 2024-12-19

### 🐛 CSP和错误处理修复
- ✅ 修复Content Security Policy (CSP) 违规错误
- ✅ 移除所有内联事件处理器 (onclick, onload等)
- ✅ 改进下载状态监听，修复"Download must be complete"错误
- ✅ 增强扩展上下文失效时的错误处理
- ✅ 使用事件委托和addEventListener替代内联事件

### 🔧 技术改进
- 🎯 重构所有HTML文件的事件处理机制
- 🛡️ 增强消息传递的错误处理和容错性
- 📋 改进下载过程的状态跟踪
- 🔍 添加下载超时保护机制

### 📁 修复的文件
- debug.html - 移除所有onclick事件
- help.html - 使用addEventListener绑定事件
- tweet-browser.html - 使用事件委托处理动态内容
- background.js - 改进下载和消息处理逻辑

---

## [v1.1.2] - 2024-12-19

### 🐛 紧急修复
- ✅ 修复v1.1.1中导致收藏失败的模板字符串错误
- ✅ 修复HTML格式无法正确保存的问题
- ✅ 增强数据验证，防止空值导致的模板错误
- ✅ 改进用户信息和推文内容的默认值处理

### 🔧 技术改进
- 🛡️ 为所有模板变量添加默认值保护
- 📋 移除可能干扰运行的调试日志
- 🎯 优化HTML和Markdown生成的健壮性
- 🔍 改进空值和undefined的处理逻辑

---

## [v1.1.1] - 2024-12-19

### 🐛 重要修复
- ✅ 修复HTML保存格式中出现无关图片的bug
- ✅ 优化图片提取逻辑，排除用户头像、表情符号和界面图标
- ✅ 改进媒体文件检测，只有真正的推文图片才会被保存
- ✅ 修复无图片推文在HTML格式中仍显示媒体部分的问题

### 🔧 技术改进
- 🎯 使用更精确的图片选择器，避免误提取界面元素
- 🛡️ 增强媒体文件过滤机制，排除profile_images、emoji、icon等
- 📋 增加详细的调试日志，便于问题排查
- 🔍 改进媒体文件存在性检查逻辑

---

## [v1.1.0] - 2024-12-19

### 🎉 新增功能
- ✨ 新增调试工具页面，支持实时诊断和问题修复
- 📖 新增详细的使用帮助页面，包含常见问题解答
- 🔧 新增一键修复常见问题功能
- 📝 新增实时日志记录和导出功能
- 🧪 新增功能测试工具（下载、存储、路径验证）

### 🛠️ 改进优化
- 🔄 大幅改进设置保存和读取的错误处理机制
- 📁 增强路径验证和清理功能，支持更多路径格式
- 💬 优化错误提示信息，提供具体的解决步骤
- 🎨 改进用户界面，添加帮助和调试按钮
- 📊 改进文件下载逻辑，支持更准确的MIME类型
- 🔐 增强权限检查和状态显示

### 🐛 修复问题
- ✅ 修复保存路径设置失效的问题
- ✅ 修复收藏按钮提示"请先设置保存路径"的问题
- ✅ 修复设置无法保存或保存后丢失的问题
- ✅ 修复路径验证逻辑中的边界情况
- ✅ 修复媒体文件下载失败影响主功能的问题
- ✅ 修复文件名包含特殊字符导致下载失败的问题

### 🔧 技术改进
- 📦 重构后台脚本的错误处理逻辑
- 🎯 优化设置存储的异步处理
- 🛡️ 增强数据验证和错误边界处理
- 📋 改进日志记录和调试信息输出
- 🔍 增加详细的状态检查和诊断功能

### 📚 文档更新
- 📖 新增完整的使用帮助文档
- 🔧 新增调试工具使用说明
- ❓ 新增常见问题解答部分
- 📝 更新README文档结构

---

## [v1.0.0] - 2024-12-18

### 🎉 首次发布
- 🐦 支持在Twitter/X推文旁添加收藏按钮
- 📁 支持自定义本地保存路径
- 🎨 支持多种文件格式（JSON、HTML、Markdown）
- 🖼️ 支持自动下载推文中的媒体文件
- ⚡ 支持实时适配新发布的推文
- 🌙 完美适配Twitter的深色主题
- 📖 内置推文浏览器功能
- 🔍 支持搜索和筛选功能
- 🔒 完全本地化，保护用户隐私

### 🎯 核心功能
- 一键收藏推文到本地
- 完整保存推文信息（用户、内容、时间、互动数据）
- 批量媒体文件下载
- 本地推文浏览和管理

### 🛡️ 安全特性
- 所有数据仅保存在本地
- 不收集任何用户信息
- 不跟踪用户行为
- 开源透明代码

---

## 版本说明

### 版本号规则
采用语义化版本控制 (Semantic Versioning)：
- **主版本号**：不兼容的API修改
- **次版本号**：向下兼容的功能性新增
- **修订号**：向下兼容的问题修正

### 图标说明
- 🎉 新增功能
- 🛠️ 改进优化  
- 🐛 修复问题
- 🔧 技术改进
- 📚 文档更新
- 🛡️ 安全更新
- ⚡ 性能优化
- 🎨 界面改进 